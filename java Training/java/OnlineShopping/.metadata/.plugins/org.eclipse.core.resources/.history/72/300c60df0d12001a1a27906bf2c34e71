package com.allianz.shopping.controller;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.allianz.shopping.dao.AddToCardDAOImpl;
import com.allianz.shopping.dao.AddToCartDAO;
import com.allianz.shopping.dao.CustomerDAO;
import com.allianz.shopping.dao.CustomerDAOImpl;
import com.allianz.shopping.dao.OrderDAO;
import com.allianz.shopping.dao.OrderDAOImpl;
import com.allianz.shopping.dao.ProductDAO;
import com.allianz.shopping.dao.ProductDAODatabaseImpl;
import com.allianz.shopping.model.AddToCart;
import com.allianz.shopping.model.Customer;
import com.allianz.shopping.model.Order;

/**
 * Servlet implementation class OrderController
 */
@WebServlet("/OrderController")
public class OrderController extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public OrderController() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String action = request.getParameter("action");
		String username = (String) request.getAttribute("username");
		
		OrderDAO orderDao = new OrderDAOImpl();
		
		if(action != null && action.equalsIgnoreCase("getAllOrderByUserName"))
		{
			/*
			 * List<Order> getAllOrderByUserName = new ArrayList<Order>();
			 * getAllOrderByUserName = orderDao.getAllOrderByUserName(username);
			 * 
			 * if(getAllOrderByUserName != null) {
			 * System.out.println("getAllOrderByUserName is not null");
			 * System.out.println(getAllOrderByUserName); int i = 1; for(Order order:
			 * getAllOrderByUserName) { System.out.println( i +
			 * "-------------------------"); System.out.println("Order id :" +
			 * order.getOrderId()); System.out.println("Order Date: " +
			 * order.getOrderDate()); System.out.println("UserName: " +
			 * order.getUsername()); System.out.println("Total Purchased Price: "+
			 * order.getTotalPrice()); System.out.println("Add To cart List");
			 * List<AddToCart> addToList = order.getAddTocartList(); for(AddToCart
			 * addToCart: addToList) { System.out.println( i + "AddTocart id : " +
			 * addToCart.getAddToCard()); System.out.println( i + "Quantity : " +
			 * addToCart.getQuantity()); System.out.println( i + "Product id" +
			 * addToCart.getProductId()); System.out.println( i + "Total" +
			 * addToCart.getTotal()); } }
			 * 
			 * RequestDispatcher requestDispatcher =
			 * request.getRequestDispatcher("getAllOrderByUserName.jsp");
			 * request.setAttribute("getAllOrderByUserName", getAllOrderByUserName);
			 * requestDispatcher.forward(request, response); } else {
			 * System.out.println("getAllOrderByUserName is not null");
			 * System.out.println(getAllOrderByUserName); int i = 1; for(Order order:
			 * getAllOrderByUserName) { System.out.println( i +
			 * "-------------------------"); System.out.println("Order id :" +
			 * order.getOrderId()); System.out.println("Order Date: " +
			 * order.getOrderDate()); System.out.println("UserName: " +
			 * order.getUsername()); System.out.println("Total Purchased Price: "+
			 * order.getTotalPrice()); System.out.println("Add To cart List");
			 * List<AddToCart> addToList = order.getAddTocartList(); for(AddToCart
			 * addToCart: addToList) { System.out.println( i + "AddTocart id : " +
			 * addToCart.getAddToCard()); System.out.println( i + "Quantity : " +
			 * addToCart.getQuantity()); System.out.println( i + "Product id" +
			 * addToCart.getProductId()); System.out.println( i + "Total" +
			 * addToCart.getTotal()); } }
			 * 
			 * System.out.println("getAllOrderByUserName is null");
			 * System.out.println(getAllOrderByUserName);
			 * response.sendRedirect("ProductDBController");
			 * }
			 */

			CustomerDAO customerDAO = new CustomerDAOImpl();
			Customer customer = customerDAO.getCustomerOrderDetails(username);
			ProductDAO productdao = new ProductDAODatabaseImpl();
			List<String> productNameList = new ArrayList<String>();
			AddToCartDAO addToCartDAO = new AddToCardDAOImpl();
			
			/*
			 * System.out.println("---------------------------------------------------");
			 * System.out.println("Customer Name :" + customer.getName());
			 * System.out.println("Customer id : " + customer.getCustomerId());
			 * System.out.println("Mobile Number : " + customer.getPhonenumber());
			 * System.out.println("OrderList is : " + customer.getOrderList());
			 * 
			 * System.out.println("******************************"); List<Order> orderList =
			 * customer.getOrderList(); for(Order order: orderList) { int id =
			 * order.getOrderId(); System.out.println("Order id :" + id);
			 * System.out.println("Total price: " + order.getTotalPrice());
			 * System.out.println("Order Date: " + order.getOrderDate()); List <AddToCart>
			 * addToCartList1 = addToCartDAO.getAllAddToCartByOrderId(id);
			 * 
			 * //System.out.println("Add To cart List is : " + addToCartList1 );
			 * 
			 * for(AddToCart obj: addToCartList1) { System.out.println("Product id : " +
			 * obj.getProductId()); System.out.println("Quantity of Product id " +
			 * obj.getProductId() + " is " + obj.getQuantity());
			 * System.out.println("Total Price :" + obj.getTotal()); String productName =
			 * productdao.getProductNameByProductId(obj.getProductId());
			 * System.out.println("Product Name : " + productName);
			 * productNameList.add(productName); }
			 * System.out.println("******************************"); }
			 * 
			 * System.out.println("---------------------------------------------------");
			 */
			
			List <AddToCart> addToCartList1 = null;
			customer.getName();
			customer.getCustomerId();
			customer.getPhonenumber();
			customer.getOrderList();
			
			System.out.println("customer : " + customer);
			
			List<Order> orderList = customer.getOrderList();
			System.out.println("OrderList : " + orderList);
			request.setAttribute("customer", customer);
			request.setAttribute("orderList", orderList);
			
			for(Order order: orderList)
			{
				int id = order.getOrderId();
				order.getTotalPrice();
				order.getOrderDate();
				if(addToCartList1 == null)
				{
					addToCartList1 = addToCartDAO.getAllAddToCartByOrderId(id);
				}
				else
				{
					List<AddToCart> addTocardList2 = addToCartDAO.getAllAddToCartByOrderId(id);
					addToCartList1.addAll(addTocardList2);
				}
				request.setAttribute("addToCartList1", addToCartList1);	
				
				for(AddToCart obj: addToCartList1)
				{
					
					obj.getProductId();
					obj.getQuantity();
					obj.getTotal();
					System.out.println("List of add to cart");
					System.out.println(obj);
					String productName = productdao.getProductNameByProductId(obj.getProductId());
					productNameList.add(productName);
				}
			}
			
			request.setAttribute("productNameList", productNameList);
			
			
			RequestDispatcher requestDispatcher = request.getRequestDispatcher("AddToCartDisplay.jsp");
			//System.out.println(addToCartList);
			//request.setAttribute("addToCartList", addToCartList);
			
			requestDispatcher.forward(request, response);
			
		}
		
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
